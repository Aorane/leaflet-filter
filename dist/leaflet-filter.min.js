/*! @asymmetrik/leaflet-filter-1.0.0 - Copyright Asymmetrik, Ltd. 2007-2017 - All Rights Reserved.*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.leafletD3=t.leafletD3||{})}(this,function(t){"use strict";L.filterLocal={filter:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},buttons:{rectangle:"Draw a bounding box filter",polygon:"Draw a bounding polygon filter",circle:"Draw a bounding circle filter",disabled:"Filter already applied",clear:"Clear current filter",clearDisabled:"No active filter"}},handlers:{simpleshape:{tooltip:{end:"Release mouse to finish drawing."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},polyline:{tooltip:{start:"Not used"}},polygon:{tooltip:{start:"Click to draw polygon points."}},circle:{tooltip:{start:"Click and drag to draw circle."}}}}},L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Polygon=L.Draw.Polygon.extend({statics:{TYPE:"polygon"},includes:[L.Mixin.Events]}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Circle=L.Draw.Circle.extend({statics:{TYPE:"circle"},includes:[L.Mixin.Events]}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Rectangle=L.Draw.Rectangle.extend({statics:{TYPE:"rectangle"},includes:[L.Mixin.Events]}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Clear=L.EditToolbar.Delete.extend({statics:{TYPE:"clear"},includes:[L.Mixin.Events],initialize:function(t,e){L.EditToolbar.Delete.prototype.initialize.call(this,t,e),this.type=L.Filter.Clear.TYPE}}),L.Control.Filter=L.Control.extend({options:{position:"topleft",filter:{rectangle:{},polygon:{},circle:{},featureGroup:null}},initialize:function(t){L.Control.prototype.initialize.call(this,t),L.FilterToolbar&&this.options.filter&&(this._toolbar=new L.FilterToolbar(this.options.filter))},onAdd:function(t){var e,l=L.DomUtil.create("div","leaflet-draw"),i="leaflet-draw-toolbar-top";return e=this._toolbar.addToolbar(t),e&&(L.DomUtil.hasClass(e,i)||L.DomUtil.addClass(e.childNodes[0],i),l.appendChild(e)),t.on("filter:created",this._filterCreatedHandler,this),t.on("filter:cleared",this._filterClearedHandler,this),l},onRemove:function(t){t.off("filter:created",this._filterCreatedHandler,this),t.off("filter:cleared",this._filterClearedHandler,this),null!=this._featureGroup&&this._featureGroup.shape.off("edit",this._filterUpdatedHandler,this),this._toolbar.removeToolbar()},equals:function(t,e){return this._toolbar.equals(t,e)},setFilter:function(t){var e=null!=this._featureGroup?this._getGeo(this._featureGroup.type,this._featureGroup.shape):void 0;if(!this._toolbar.equals(e,t)){var l;null!=t&&(l=this._toolbar.setFilter(t)),null!=l?(this._clearFilter(!0),this._createFilter(l)):this._clearFilter()}},_createFilter:function(t,e){this.options.featureGroup.addLayer(t.layer),this._featureGroup={shape:t.layer,type:t.type},this._featureGroup.shape.on("edit",this._filterUpdatedHandler,this),e||this._map.fire("filter:filter",{geo:this._getGeo(t.type,t.layer)}),this._toolbar.setFiltered(!0)},_clearFilter:function(t){this.options.featureGroup.clearLayers(),this._featureGroup=void 0,t||this._map.fire("filter:filter",{geo:void 0}),this._toolbar.setFiltered(!1)},_filterCreatedHandler:function(t){this._createFilter({type:t.layerType,layer:t.layer})},_filterUpdatedHandler:function(){if(null!=this._featureGroup){var t={geo:this._getGeo(this._featureGroup.type,this._featureGroup.shape)};this._map.fire("filter:filter",t)}},_filterClearedHandler:function(){this._clearFilter()},_getGeo:function(t,e){return this._toolbar.getGeo(t,e)},setFilteringOptions:function(t){this._toolbar.setOptions(t)}}),L.Map.mergeOptions({drawControlTooltips:!0,filterControl:!1}),L.Map.addInitHook(function(){this.options.filterControl&&(this.filterControl=new L.Control.Filter,this.addControl(this.filterControl))}),L.control.filter=function(t){return new L.Control.Filter(t)},L.FilterToolbar=L.DrawToolbar.extend({statics:{TYPE:"filter"},options:{polygon:{},rectangle:{},circle:{}},initialize:function(t){L.DrawToolbar.prototype.initialize.call(this,t),this._toolbarClass="leaflet-draw-draw"},getModeHandlers:function(t){return[{enabled:this.options.polygon,handler:new L.Filter.Polygon(t,this.options.polygon),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Filter.Rectangle(t,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Filter.Circle(t,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:!0,handler:new L.Filter.Clear(t,{featureGroup:this.options.featureGroup}),title:L.drawLocal.draw.toolbar.buttons.circle}]},getActions:function(t){return L.DrawToolbar.prototype.getActions(t)},setOptions:function(t){L.DrawToolbar.prototype.setOptions(t)},addTo:function(t){var e=t.addToolbar(this);return this.setFiltered(!1),e},setFiltered:function(t){var e;if(t){for(e in this._modes)L.DomUtil.addClass(this._modes[e].button,"leaflet-disabled"),this._modes[e].button.setAttribute("title",L.filterLocal.filter.toolbar.buttons.disabled),this._modes[e].handler.lock();L.DomUtil.removeClass(this._modes.clear.button,"leaflet-disabled"),this._modes.clear.button.setAttribute("title",L.filterLocal.filter.toolbar.buttons.clear),this._modes.clear.handler.unlock()}else{for(e in this._modes)L.DomUtil.removeClass(this._modes[e].button,"leaflet-disabled"),this._modes[e].button.setAttribute("title",L.filterLocal.filter.toolbar.buttons[e]),this._modes[e].handler.unlock();L.DomUtil.addClass(this._modes.clear.button,"leaflet-disabled"),this._modes.clear.button.setAttribute("title",L.filterLocal.filter.toolbar.buttons.clearDisabled),this._modes.clear.handler.lock()}},setFilter:function(t){return null!=this._modes[t.type]?this._modes[t.type].handler.setFilter(t):void console.error("Unsupported filter type: "+t.type)},getGeo:function(t,e){return this._modes[t].handler.getGeo(e)},equals:function(t,e){return null!=t&&null!=t.type||(t=null),null!=e&&null!=e.type||(e=null),null==t&&null==e||null!=t&&null!=e&&this._modes[t.type].handler.equals(t,e)}}),Object.defineProperty(t,"__esModule",{value:!0})});