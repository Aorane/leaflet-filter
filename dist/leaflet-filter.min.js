/*! leaflet-filter Version: 0.2.3 */
!function(){"use strict";L.FontAwesomeToolbar=L.Class.extend({includes:[L.Mixin.Events],initialize:function(t){L.setOptions(this,t),this._modes={},this._actionButtons=[],this._activeMode=null},enabled:function(){return null!==this._activeMode},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(t){var e,i=L.DomUtil.create("div","leaflet-draw-section"),o=0,n=this._toolbarClass||"",s=this.getModeHandlers(t);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-fa-toolbar leaflet-bar"),this._map=t,e=0;e<s.length;e++)s[e].enabled&&this._initModeHandler(s[e].handler,this._toolbarContainer,o++,n,s[e].title,s[e].icon);return o?(this._lastButtonIndex=--o,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),i.appendChild(this._toolbarContainer),i.appendChild(this._actionsContainer),i):void 0},removeToolbar:function(){for(var t in this._modes)this._modes.hasOwnProperty(t)&&(this._disposeButton(this._modes[t].button,this._modes[t].handler.enable,this._modes[t].handler),this._modes[t].handler.disable(),this._modes[t].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var e=0,i=this._actionButtons.length;i>e;e++)this._disposeButton(this._actionButtons[e].button,this._actionButtons[e].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(t,e,i,o,n,s){var l=t.type;this._modes[l]={},this._modes[l].handler=t,this._modes[l].button=this._createButton({title:n,icon:s,className:o+"-"+l,container:e,callback:this._modes[l].handler.enable,context:this._modes[l].handler}),this._modes[l].buttonIndex=i,this._modes[l].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_createButton:function(t){var e=L.DomUtil.create("a",t.className||"",t.container);return null!=t.icon&&L.DomUtil.create("i",t.icon,e),e.href="#",t.text&&(e.innerHTML=t.text),t.title&&(e.title=t.title),L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"mousedown",L.DomEvent.stopPropagation).on(e,"dblclick",L.DomEvent.stopPropagation).on(e,"click",L.DomEvent.preventDefault).on(e,"click",t.callback,t.context),e},_disposeButton:function(t,e){L.DomEvent.off(t,"click",L.DomEvent.stopPropagation).off(t,"mousedown",L.DomEvent.stopPropagation).off(t,"dblclick",L.DomEvent.stopPropagation).off(t,"click",L.DomEvent.preventDefault).off(t,"click",e)},_handlerActivated:function(t){this.disable(),this._activeMode=this._modes[t.handler],L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar(),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(t){var e,i,o,n,s=this._actionsContainer,l=this.getActions(t),a=l.length;for(i=0,o=this._actionButtons.length;o>i;i++)this._disposeButton(this._actionButtons[i].button,this._actionButtons[i].callback);for(this._actionButtons=[];s.firstChild;)s.removeChild(s.firstChild);for(var r=0;a>r;r++)"enabled"in l[r]&&!l[r].enabled||(e=L.DomUtil.create("li","",s),n=this._createButton({title:l[r].title,text:l[r].text,container:e,callback:l[r].callback,context:l[r].context}),this._actionButtons.push({button:n,callback:l[r].callback}))},_showActionsToolbar:function(){var t=this._activeMode.buttonIndex,e=this._lastButtonIndex,i=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=i+"px",0===t&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),t===e&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block"},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom")}})}(),function(){"use strict";L.filterLocal={filter:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},buttons:{rectangle:"Draw a bounding box filter",disabled:"Filter already applied",clear:"Clear current filter",clearDisabled:"No active filter"}},handlers:{simpleshape:{tooltip:{end:"Release mouse to finish drawing."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}}}}}}(),function(){"use strict";L.Filter={},L.Filter.Feature=L.Handler.extend({includes:L.Mixin.Events,initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,e&&e.shapeOptions&&(e.shapeOptions=L.Util.extend({},this.options.shapeOptions,e.shapeOptions)),L.setOptions(this,e)},enable:function(){this._enabled||this.isLocked()||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire("filter:filterstart",{layerType:this.type}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire("filter:filterstop",{layerType:this.type}),this.fire("disabled",{handler:this.type}))},lock:function(){this._locked=!0},unlock:function(){this._locked=!1},isLocked:function(){return null!=this._locked&&this._locked},addHooks:function(){var t=this._map;t&&(L.DomUtil.disableTextSelection(),t.getContainer().focus(),this._tooltip=new L.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(t){L.setOptions(this,t)},_fireCreatedEvent:function(t){this._map.fire("filter:created",{layer:t,layerType:this.type})},_cancelDrawing:function(t){27===t.keyCode&&this.disable()}})}(),function(){"use strict";L.Filter.SimpleShape=L.Filter.Feature.extend({options:{},initialize:function(t,e){this._endLabelText=L.filterLocal.filter.handlers.simpleshape.tooltip.end,L.Filter.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Filter.Feature.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Filter.Feature.prototype.removeHooks.call(this),this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this),L.DomEvent.off(document,"mouseup",this._onMouseUp,this),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(t){this._isDrawing=!0,this._startLatLng=t.latlng,L.DomEvent.on(document,"mouseup",this._onMouseUp,this).preventDefault(t.originalEvent)},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._isDrawing&&(this._tooltip.updateContent(this._getTooltipText()),this._drawShape(e))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable()}})}(),function(){"use strict";L.Filter=L.Filter||{},L.Filter.Rectangle=L.Filter.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,editable:!0},metric:!0},initialize:function(t,e){this.type=L.Filter.Rectangle.TYPE,this._initialLabelText=L.filterLocal.filter.handlers.rectangle.tooltip.start,L.Filter.SimpleShape.prototype.initialize.call(this,t,e)},getGeo:function(t){return{type:"rectangle",northEast:{lat:t.getBounds()._northEast.lat,lng:t.getBounds()._northEast.lng},southWest:{lat:t.getBounds()._southWest.lat,lng:t.getBounds()._southWest.lng}}},setFilter:function(t){this.enable(),this._isDrawing=!0,this._startLatLng=t.northEast;var e=this._drawShape(t.southWest);return this.disable(),e},equals:function(t,e){return t.type!=e.type?!1:t.northEast.lat===e.northEast.lat&&t.northEast.lng===e.northEast.lng&&t.southWest.lat===e.southWest.lat&&t.southWest.lng===e.southWest.lng},_drawShape:function(t){return this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,t)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,t),this.options.shapeOptions),this._map.addLayer(this._shape)),{type:"rectangle",layer:this._shape}},_fireCreatedEvent:function(){var t=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Filter.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,o=L.Filter.SimpleShape.prototype._getTooltipText.call(this),n=this._shape;return n&&(t=this._shape.getLatLngs(),e=L.GeometryUtil.geodesicArea(t),i=L.GeometryUtil.readableArea(e,this.options.metric)),{text:o.text,subtext:i}}})}(),function(){"use strict";L.Filter=L.Filter||{},L.Filter.Clear=L.Handler.extend({statics:{TYPE:"clear"},includes:L.Mixin.Events,initialize:function(t,e){L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,e),this.type=L.Filter.Clear.TYPE},lock:function(){this._locked=!0},unlock:function(){this._locked=!1},isLocked:function(){return null!=this._locked&&this._locked},enable:function(){this.isLocked()||this._map.fire("filter:cleared")},disable:function(){}})}(),function(){"use strict";L.Control.Filter=L.Control.extend({options:{position:"topleft",filter:{rectangle:{}}},initialize:function(t){L.Control.prototype.initialize.call(this,t),L.FilterToolbar&&this.options.filter&&(this._toolbar=new L.FilterToolbar(this.options.filter))},onAdd:function(t){var e,i=L.DomUtil.create("div","leaflet-draw"),o=!1,n="leaflet-draw-toolbar-top";return e=this._toolbar.addToolbar(t),e&&(o||(L.DomUtil.hasClass(e,n)||L.DomUtil.addClass(e.childNodes[0],n),o=!0),i.appendChild(e)),t.on("filter:created",this._filterCreatedHandler,this),t.on("filter:cleared",this._filterClearedHandler,this),i},onRemove:function(t){t.off("filter:created",this._filterCreatedHandler,this),t.off("filter:cleared",this._filterClearedHandler,this),null!=this._filterGroup&&this._filterGroup.shape.off("edit",this._filterUpdatedHandler,this),this._toolbar.removeToolbar()},equals:function(t,e){return this._toolbar.equals(t,e)},setFilter:function(t){if(null!=t){var e=this._toolbar.setFilter(t);this._clearFilter(!0),this._createFilter(e)}else this._clearFilter()},_createFilter:function(t,e){this.options.filterGroup.addLayer(t.layer),this._filterGroup={shape:t.layer,type:t.type},this._filterGroup.shape.on("edit",this._filterUpdatedHandler,this),e||this._map.fire("filter:filter",{geo:this._getGeo(t.type,t.layer)}),this._toolbar.setFiltered(!0)},_clearFilter:function(t){this.options.filterGroup.clearLayers(),t||this._map.fire("filter:filter",{geo:void 0}),this._toolbar.setFiltered(!1)},_filterCreatedHandler:function(t){this._createFilter({type:t.layerType,layer:t.layer})},_filterUpdatedHandler:function(){if(null!=this._filterGroup){var t={geo:this._getGeo(this._filterGroup.type,this._filterGroup.shape)};this._map.fire("filter:filter",t)}},_filterClearedHandler:function(){this._clearFilter()},_getGeo:function(t,e){return this._toolbar.getGeo(t,e)},setFilteringOptions:function(t){this._toolbar.setOptions(t)}}),L.Map.mergeOptions({drawControlTooltips:!1,filterControl:!1}),L.Map.addInitHook(function(){this.options.filterControl&&(this.filterControl=new L.Control.Filter,this.addControl(this.filterControl))})}(),function(){"use strict";L.FilterToolbar=L.FontAwesomeToolbar.extend({options:{rectangle:{}},initialize:function(t){for(var e in this.options)this.options.hasOwnProperty(e)&&t[e]&&(t[e]=L.extend({},this.options[e],t[e]));this._toolbarClass="leaflet-draw-filter",L.FontAwesomeToolbar.prototype.initialize.call(this,t)},getModeHandlers:function(t){var e=[];return null!=L.Filter.Rectangle&&e.push({enabled:this.options.rectangle,handler:new L.Filter.Rectangle(t,this.options.rectangle),title:L.filterLocal.filter.toolbar.buttons.rectangle,icon:"fa fa-square-o"}),null!=L.Filter.Clear&&e.push({enabled:!0,handler:new L.Filter.Clear(t,this.options.clear),title:L.filterLocal.filter.toolbar.buttons.clear,icon:"fa fa-trash-o"}),e},getActions:function(){return[{title:L.filterLocal.filter.toolbar.actions.title,text:L.filterLocal.filter.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(t){L.setOptions(this,t);for(var e in this._modes)this._modes.hasOwnProperty(e)&&t.hasOwnProperty(e)&&this._modes[e].handler.setOptions(t[e])},addToolbar:function(t){var e=L.FontAwesomeToolbar.prototype.addToolbar.call(this,t);return this.setFiltered(!1),e},setFiltered:function(t){var e;if(t){for(e in this._modes)L.DomUtil.addClass(this._modes[e].button,"leaflet-disabled"),this._modes[e].button.setAttribute("title",L.filterLocal.filter.toolbar.buttons.disabled),this._modes[e].handler.lock();L.DomUtil.removeClass(this._modes.clear.button,"leaflet-disabled"),this._modes.clear.button.setAttribute("title",L.filterLocal.filter.toolbar.buttons.clear),this._modes.clear.handler.unlock()}else{for(e in this._modes)L.DomUtil.removeClass(this._modes[e].button,"leaflet-disabled"),this._modes[e].button.setAttribute("title",L.filterLocal.filter.toolbar.buttons[e]),this._modes[e].handler.unlock();L.DomUtil.addClass(this._modes.clear.button,"leaflet-disabled"),this._modes.clear.button.setAttribute("title",L.filterLocal.filter.toolbar.buttons.clearDisabled),this._modes.clear.handler.lock()}},setFilter:function(t){return null!=this._modes[t.type]?this._modes[t.type].handler.setFilter(t):void console.error("Unsupported filter type: "+t.type)},getGeo:function(t,e){return this._modes[t].handler.getGeo(e)},equals:function(t,e){return null==t&&null==e?!0:null==t||null==e?!1:this._modes[t.type].handler.equals(t,e)}})}();