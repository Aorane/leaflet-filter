/*! @asymmetrik/leaflet-filter - 1.0.11 - Copyright Asymmetrik, Ltd. 2007-2017 - All Rights Reserved. */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("leaflet")):"function"==typeof define&&define.amd?define(["exports","leaflet"],e):e(t.leafletFilter={})}(this,function(t){"use strict";L.filterLocal={filter:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},buttons:{rectangle:"Draw a bounding box filter",polygon:"Draw a bounding polygon filter",polyline:"",circle:"Draw a bounding circle filter",disabled:"Filter already applied",clear:"Clear current filter",clearDisabled:"No active filter"}},handlers:{simpleshape:{tooltip:{end:"Release mouse to finish drawing."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},polyline:{tooltip:{start:"",cont:"",end:""}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},circle:{tooltip:{start:"Click and drag to draw circle."}}}}},L.FontAwesomeToolbar=L.Class.extend({includes:L.Mixin.Events,initialize:function(t){L.setOptions(this,t),this._modes={},this._actionButtons=[],this._activeMode=null},enabled:function(){return null!==this._activeMode},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(t){var e,i=L.DomUtil.create("div","leaflet-draw-section"),o=0,n=this._toolbarClass||"",s=this.getModeHandlers(t);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-fa-toolbar leaflet-bar"),this._map=t,e=0;e<s.length;e++)this._initModeHandler(s[e].handler,this._toolbarContainer,s[e].enabled?o++:-1,n,s[e].title,s[e].icon);
// if no buttons were added, do not add the toolbar
if(o)
// Save button index of the last button, -1 as we would have ++ after the last button
// Create empty actions part of the toolbar
// Add draw and cancel containers to the control container
return this._lastButtonIndex=--o,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),i.appendChild(this._toolbarContainer),i.appendChild(this._actionsContainer),i},getModeHandlers:function(t){return[]},removeToolbar:function(){
// Dispose each handler
for(var t in this._modes)this._modes.hasOwnProperty(t)&&(
// Unbind handler button
this._disposeButton(this._modes[t].button,this._modes[t].handler.enable,this._modes[t].handler),
// Make sure is disabled
this._modes[t].handler.disable(),
// Unbind handler
this._modes[t].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};
// Dispose the actions toolbar
for(var e=0,i=this._actionButtons.length;e<i;e++)this._disposeButton(this._actionButtons[e].button,this._actionButtons[e].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(t,e,i,o,n,s){var a=t.type;this._modes[a]={},this._modes[a].handler=t,
// a button index of -1 means the button is disabled
-1!==i&&(this._modes[a].button=this._createButton({title:n,icon:s,className:o+"-"+a,container:e,callback:this._modes[a].handler.enable,context:this._modes[a].handler}),this._modes[a].buttonIndex=i),this._modes[a].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_createButton:function(t){var e=L.DomUtil.create("a",t.className||"",t.container);null!=t.icon&&L.DomUtil.create("i",t.icon,e),e.href="#",t.text&&(e.innerHTML=t.text),t.title&&(e.title=t.title);/* iOS does not use click events */
var i=this._detectIOS()?"touchstart":"click";return L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"mousedown",L.DomEvent.stopPropagation).on(e,"dblclick",L.DomEvent.stopPropagation).on(e,"touchstart",L.DomEvent.stopPropagation).on(e,"click",L.DomEvent.preventDefault).on(e,i,t.callback,t.context),e},_disposeButton:function(t,e){/* iOS does not use click events */
var i=this._detectIOS()?"touchstart":"click";L.DomEvent.off(t,"click",L.DomEvent.stopPropagation).off(t,"mousedown",L.DomEvent.stopPropagation).off(t,"dblclick",L.DomEvent.stopPropagation).off(t,"touchstart",L.DomEvent.stopPropagation).off(t,"click",L.DomEvent.preventDefault).off(t,i,e)},_handlerActivated:function(t){
// Disable active mode (if present)
this.disable(),
// Cache new active feature
this._activeMode=this._modes[t.handler],null!=this._activeMode.button&&(L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar()),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),null!=this._activeMode.button&&L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(t){var e,i,o,n,s=this._actionsContainer,a=this.getActions(t),l=a.length;
// Dispose the actions toolbar
for(i=0,o=this._actionButtons.length;i<o;i++)this._disposeButton(this._actionButtons[i].button,this._actionButtons[i].callback);
// Remove all old buttons
for(this._actionButtons=[];s.firstChild;)s.removeChild(s.firstChild);for(var r=0;r<l;r++)"enabled"in a[r]&&!a[r].enabled||(e=L.DomUtil.create("li","",s),n=this._createButton({title:a[r].title,text:a[r].text,container:e,callback:a[r].callback,context:a[r].context}),this._actionButtons.push({button:n,callback:a[r].callback}))},_showActionsToolbar:function(){var t=this._activeMode.buttonIndex,e=this._lastButtonIndex,i=this._activeMode.button.offsetTop-1;
// Recreate action buttons on every click
this._createActions(this._activeMode.handler),
// Correctly position the cancel button
this._actionsContainer.style.top=i+"px",0===t&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),t===e&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block"},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom")},_detectIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream}}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Feature=L.Handler.extend({includes:L.Mixin.Events,initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,
// Merge default shapeOptions options with custom shapeOptions
e&&e.shapeOptions&&(e.shapeOptions=L.Util.extend({},this.options.shapeOptions,e.shapeOptions)),L.setOptions(this,e)},enable:function(t){this._enabled||this.isLocked()||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),t||this._map.fire("filter:filterstart",{layerType:this.type}))},disable:function(t){this._enabled&&(L.Handler.prototype.disable.call(this),t||this._map.fire("filter:filterstop",{layerType:this.type}),this.fire("disabled",{handler:this.type}))},lock:function(){this._locked=!0},unlock:function(){this._locked=!1},isLocked:function(){return null!=this._locked&&this._locked},addHooks:function(){var t=this._map;t&&(L.DomUtil.disableTextSelection(),t.getContainer().focus(),this._tooltip=new L.Draw.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(t){L.setOptions(this,t)},_fireCreatedEvent:function(t){this._map.fire("filter:created",{layer:t,layerType:this.type})},
// Cancel drawing when the escape key is pressed
_cancelDrawing:function(t){27===t.keyCode&&this.disable()}}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.SimpleShape=L.Filter.Feature.extend({options:{},initialize:function(t,e){this._endLabelText=L.filterLocal.filter.handlers.simpleshape.tooltip.end,L.Filter.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Filter.Feature.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),
//TODO refactor: move cursor to styles
this._container.style.cursor="crosshair",this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this).on("touchstart",this._onMouseDown,this).on("touchmove",this._onMouseMove,this))},removeHooks:function(){if(L.Filter.Feature.prototype.removeHooks.call(this),this._isDrawing=!1,this._map&&(this._mapDraggable&&this._map.dragging.enable(),
//TODO refactor: move cursor to styles
this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this).off("touchstart",this._onMouseDown,this).off("touchmove",this._onMouseMove,this),L.DomEvent.off(document,"mouseup",this._onMouseUp,this),L.DomEvent.off(document,"touchend",this._onMouseUp,this),this._shape)){try{this._map.removeLayer(this._shape)}catch(t){}delete this._shape}},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(t){this._isDrawing=!0,this._startLatLng=t.latlng,L.DomEvent.on(document,"mouseup",this._onMouseUp,this).on(document,"touchend",this._onMouseUp,this).preventDefault(t.originalEvent)},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._isDrawing?(this._drawShape(e),this._tooltip.updateContent(this._getTooltipText())):this._tooltip.updateContent({text:this._initialLabelText})},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable()}}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Polyline=L.Filter.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{enabled:!0,allowIntersection:!1,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!1,clickable:!0,editable:!0},metric:!0,// Whether to use the metric meaurement system or imperial
showLength:!0,// Whether to display distance in the tooltip
zIndexOffset:2e3},initialize:function(t,e){this._endLabelText=L.filterLocal.filter.handlers.polyline.tooltip.end,
// Need to set this here to ensure the correct message is used.
this.options.drawError.message=L.filterLocal.filter.handlers.polyline.error,
// Merge default drawError options with custom options
e&&e.drawError&&(e.drawError=L.Util.extend({},this.options.drawError,e.drawError)),L.Filter.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Filter.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),
// Make a transparent marker that will used to catch click events. These click
// events will create the vertices. We need to do this so we can ensure that
// we can create vertices over other map layers (markers, vector layers). We
// also do not want to trigger any click handlers of objects we are clicking on
// while drawing.
this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mousedown",this._onMouseDown,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this).on("mouseup",this._onMouseUp,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Filter.Feature.prototype.removeHooks.call(this),this._map&&(
//TODO refactor: move cursor to styles
this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this),L.DomEvent.off(document,"mouseup",this._onMouseUp,this),/*
			 * If no markers or polygons have been created, the user has not entered
			 * anything, so there is nothing to delete or remove from the map
			 */
this._markerGroup&&(this._map.removeLayer(this._markerGroup),delete this._markerGroup),this._poly&&(this._map.removeLayer(this._poly),delete this._poly)),this._isDrawing=!1},disable:function(t){L.Filter.Feature.prototype.disable.call(this,t),this._clearMouseMarker(),this._clearGuides()},_getTooltipText:function(){return{text:this._endLabelText}},deleteLastVertex:function(){if(!(this._markers.length<=1)){var t=this._markers.pop(),e=this._poly,i=this._poly.spliceLatLngs(e.getLatLngs().length-1,1)[0];this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(i,!1)}},addVertex:function(t){this._markers.length>0&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t)||(this._markers.push(this._createMarker(t)),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(t,!0))},_finishShape:function(){var t=this._poly.newLatLngIntersects(this._poly.getLatLngs()[0],!0);!this.options.allowIntersection&&t||!this._shapeIsValid()||(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable(),
// Remove the rubberband dashed guide line from the UI
this._clearGuides(),this._clearMouseMarker())},
//Called to verify the shape is valid when the user tries to finish it
//Return false if the shape is not valid
_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._updateGuide()},_onMouseMove:function(t){var e=t.layerPoint,i=t.latlng;
// Save latlng
// should this be moved to _updateGuide() ?
this._currentLatLng=i,this._updateTooltip(i),
// Update the guide line
this._updateGuide(e),
// Update the mouse marker position
this._mouseMarker.setLatLng(i),L.DomEvent.preventDefault(t.originalEvent)},_vertexChanged:function(t,e){this._updateFinishHandler(),this._updateRunningMeasure(t,e),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(t){var e=t.originalEvent;this._mouseDownOrigin=L.point(e.clientX,e.clientY)},_onMouseUp:function(t){if(this._mouseDownOrigin){
// We detect clicks within a certain tolerance, otherwise let it
// be interpreted as a drag by the map
var e=L.point(t.originalEvent.clientX,t.originalEvent.clientY).distanceTo(this._mouseDownOrigin);Math.abs(e)<9&&this.addVertex(t.latlng)}this._mouseDownOrigin=null},_updateFinishHandler:function(){var t=this._markers.length;
// The last marker should have a click handler to close the polyline
t>1&&this._markers[t-1].on("click",this._finishShape,this),
// Remove the old marker click handler (as only the last point should close the polyline)
t>2&&this._markers[t-2].off("click",this._finishShape,this)},_createMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),e},_updateGuide:function(t){var e=this._markers.length;e>0&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),
// draw the guide line
this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[e-1].getLatLng()),t))},_updateRunningMeasure:function(t,e){var i,o,n=this._markers.length;1===this._markers.length?this._measurementRunningTotal=0:(i=n-(e?2:1),o=t.distanceTo(this._markers[i].getLatLng()),this._measurementRunningTotal+=o*(e?1:-1))},_updateTooltip:function(t){var e=this._getTooltipText();t&&this._tooltip.updatePosition(t),this._errorShown||this._tooltip.updateContent(e)},_drawGuide:function(t,e){var i,o,n,s=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))),a=this.options.guidelineDistance,l=this.options.maxGuideLineLength,
// Only draw a guideline with a max length
r=s>l?s-l:a;
//draw a dash every GuildeLineDistance
for(
//create the guides container if we haven't yet
this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));r<s;r+=this.options.guidelineDistance)
//work out fraction along line we are
i=r/s,
//calculate new x,y point
o={x:Math.floor(t.x*(1-i)+i*e.x),y:Math.floor(t.y*(1-i)+i*e.y)},(
//add guide dash to guide container
n=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer)).style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(n,o)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,i=this._guidesContainer.childNodes.length;e<i;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},/**
	 * Remove the Mouse Marker from the Map, or it will mask the click/drag
	 * events on the last placed point, preventing it from being editable after
	 * the shape is finished.
	 */
_clearMouseMarker:function(){this._mouseMarker&&(
// remove the mouse marker from the first point placement
this._map.removeLayer(this._mouseMarker),delete this._mouseMarker)},
// removes all child elements (guide dashes) from the guides container
_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var t=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Filter.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Polygon=L.Filter.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{enabled:!0,showArea:!1,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,//same as color by default
fillOpacity:.2,clickable:!0,editable:!0},metric:!0},initialize:function(t,e){
// Save the type so super can fire, need to do this as cannot do this.TYPE :(
this.type=L.Filter.Polygon.TYPE,L.Filter.Polyline.prototype.initialize.call(this,t,e),this._initialLabelText=L.filterLocal.filter.handlers.polygon.tooltip.start,this._endLabelText=L.filterLocal.filter.handlers.polygon.tooltip.end},
// Programmatic way to draw a filter rectangle (bit of a hack)
setFilter:function(t){return{type:"polygon",layer:new L.Polygon(t.latlngs,this.options.shapeOptions)}},equals:function(t,e){return t.type==e.type&&JSON.stringify(t.latlngs)==JSON.stringify(e.latlngs)},
// Get the geo representation of the current filter box
getGeo:function(t){return{type:"polygon",latlngs:t.getLatLngs()}},_drawShape:function(t){return this._poly?this._poly.setLatLngs(t):(this._poly=new L.Polygon(t,this.options.shapeOptions),this._map.addLayer(this._poly)),{type:"polygon",layer:this._poly}},_fireCreatedEvent:function(){var t=new L.Polygon(this._poly.getLatLngs(),this.options.shapeOptions);L.Filter.Polyline.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,o=L.Filter.Polyline.prototype._getTooltipText.call(this),n=this._poly;return n&&(t=n.getLatLngs(),e=L.GeometryUtil.geodesicArea(t),i=L.GeometryUtil.readableArea(e,this.options.metric)),{text:o.text,subtext:i}},_updateFinishHandler:function(){var t=this._markers.length;
// The first marker should have a click handler to close the polygon
1===t&&this._markers[0].on("click",this._finishShape,this),
// Add and update the double click handler
t>2&&(this._markers[t-1].on("dblclick",this._finishShape,this),
// Only need to remove handler if has been added before
t>3&&this._markers[t-2].off("dblclick",this._finishShape,this))},_getMeasurementString:function(){var t=this._area;return t?L.GeometryUtil.readableArea(t,this.options.metric):null},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(t,e){var i;
// Check to see if we should show the area
!this.options.allowIntersection&&this.options.showArea&&(i=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(i)),L.Filter.Polyline.prototype._vertexChanged.call(this,t,e)},_cleanUpShape:function(){var t=this._markers.length;t>0&&(this._markers[0].off("click",this._finishShape,this),t>2&&this._markers[t-1].off("dblclick",this._finishShape,this))}}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Circle=L.Filter.SimpleShape.extend({statics:{TYPE:"circle"},options:{enabled:!0,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,//same as color by default
fillOpacity:.2,clickable:!0,editable:!0},showRadius:!0,metric:!0},initialize:function(t,e){
// Save the type so super can fire, need to do this as cannot do this.TYPE :(
this.type=L.Filter.Circle.TYPE,this._initialLabelText=L.filterLocal.filter.handlers.circle.tooltip.start,L.Filter.SimpleShape.prototype.initialize.call(this,t,e)},
// Get the geo representation of the current filter box
getGeo:function(t){return{type:"circle",center:t.getLatLng(),radius:t.getRadius()}},
// Programmatic way to draw a filter circle
setFilter:function(t){
// Set startLatLng so edits remember the starting point
return this._startLatLng=t.center,{type:"circle",layer:new L.Circle(t.center,t.radius,this.options.shapeOptions)}},equals:function(t,e){return t.type==e.type&&(t.center.lat===e.center.lat&&t.center.lng===e.center.lng&&t.radius===e.radius)},_drawShape:function(t){
// Calculate the distance based on the version
var e;return e=this._isVersion07x()?this._startLatLng.distanceTo(t):this._map.distance(this._startLatLng,t),this._shape?this._shape.setRadius(e):(this._shape=new L.Circle(this._startLatLng,e,this.options.shapeOptions),this._map.addLayer(this._shape)),{type:"circle",layer:this._shape}},_fireCreatedEvent:function(){var t=new L.Circle(this._startLatLng,this._shape.getRadius(),this.options.shapeOptions);L.Filter.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,o,n=L.Filter.SimpleShape.prototype._getTooltipText.call(this),s=this._shape;return s&&(t=[(e=s.getBounds()).getNorthWest(),e.getNorthEast(),e.getSouthEast(),e.getSouthWest()],i=L.GeometryUtil.geodesicArea(t)/4*Math.PI,o=L.GeometryUtil.readableArea(i,this.options.metric)),{text:n.text,subtext:o}},_isVersion07x:function(){var t=L.version.split(".");
//If Version is == 0.7.*
return 0===parseInt(t[0],10)&&7===parseInt(t[1],10)}}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Rectangle=L.Filter.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{enabled:!0,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,//same as color by default
fillOpacity:.2,clickable:!0,editable:!0},metric:!0},initialize:function(t,e){
// Save the type so super can fire, need to do this as cannot do this.TYPE :(
this.type=L.Filter.Rectangle.TYPE,this._initialLabelText=L.filterLocal.filter.handlers.rectangle.tooltip.start,L.Filter.SimpleShape.prototype.initialize.call(this,t,e)},
// Get the geo representation of the current filter box
getGeo:function(t){return{type:"rectangle",northEast:{lat:t.getBounds()._northEast.lat,lng:t.getBounds()._northEast.lng},southWest:{lat:t.getBounds()._southWest.lat,lng:t.getBounds()._southWest.lng}}},
// Programmatic way to draw a filter rectangle (bit of a hack)
setFilter:function(t){return this._startLatLng=t.northEast,{type:"rectangle",layer:new L.Rectangle(new L.LatLngBounds(this._startLatLng,t.southWest),this.options.shapeOptions)}},equals:function(t,e){return t.type==e.type&&(t.northEast.lat===e.northEast.lat&&t.northEast.lng===e.northEast.lng&&t.southWest.lat===e.southWest.lat&&t.southWest.lng===e.southWest.lng)},_drawShape:function(t){return this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,t)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,t),this.options.shapeOptions),this._map.addLayer(this._shape)),{type:"rectangle",layer:this._shape}},_fireCreatedEvent:function(){var t=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Filter.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,o,n=L.Filter.SimpleShape.prototype._getTooltipText.call(this);return this._shape&&(t=[(e=this._shape.getBounds()).getNorthWest(),e.getNorthEast(),e.getSouthEast(),e.getSouthWest()],i=L.GeometryUtil.geodesicArea(t)/4*Math.PI,o=L.GeometryUtil.readableArea(i,this.options.metric)),{text:n.text,subtext:o}}}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Clear=L.Handler.extend({statics:{TYPE:"clear"},includes:L.Mixin.Events,initialize:function(t,e){L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,e),this.type=L.Filter.Clear.TYPE},lock:function(){this._locked=!0},unlock:function(){this._locked=!1},isLocked:function(){return null!=this._locked&&this._locked},enable:function(){this.isLocked()||this._map.fire("filter:cleared")},disable:function(){}}),L.Control.Filter=L.Control.extend({options:{position:"topleft",filter:{rectangle:{},polygon:{},circle:{}}},initialize:function(t){if(L.Control.prototype.initialize.call(this,t),null==t.featureGroup||!(t.featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be an L.FeatureGroup");
// Initialize toolbars
L.FilterToolbar&&this.options.filter&&(this._toolbar=new L.FilterToolbar(this.options.filter))},onAdd:function(t){var e,i=L.DomUtil.create("div","leaflet-draw");
// Add class to the first toolbar to remove the margin
// register for create events
return(e=this._toolbar.addToolbar(t))&&(L.DomUtil.hasClass(e,"leaflet-draw-toolbar-top")||L.DomUtil.addClass(e.childNodes[0],"leaflet-draw-toolbar-top"),i.appendChild(e)),t.on("filter:created",this._filterCreatedHandler,this),t.on("filter:cleared",this._filterClearedHandler,this),i},onRemove:function(t){
// unregister create events
t.off("filter:created",this._filterCreatedHandler,this),t.off("filter:cleared",this._filterClearedHandler,this),null!=this._filterState&&
// Unregister for the edit events
this._filterState.shape.off("edit",this._filterUpdatedHandler,this),this._toolbar.removeToolbar()},equals:function(t,e){return this._toolbar.equals(t,e)},
// Public method to programatically set the state of the filter
setFilter:function(t,e){
// Default the options
e=e||{suppressEvents:!1,fitBounds:!1};
// Check to see if a change is being applied
var i=null!=this._filterState?this._getGeo(this._filterState.type,this._filterState.shape):void 0;
// If there is no change, then we're just going to short circuit out of here
if(!this._toolbar.equals(i,t)){if(null!=t){
// Clear the old filter
this._clearFilter(!0);
// Ask the handler for the filter object
var o=this._toolbar.setFilter(t,e.suppressEvents);
// Create the new filter
this._createFilter(o,e.suppressEvents),e.fitBounds&&this._map.fitBounds(o.layer.getBounds())}else this._clearFilter();return this}},/**
	 * Programatically set the filtered state of the toolbar. This should only be
	 * used if you want to override the behavior of the control. All this will do
	 * is change the enabled state of the various controls. It will not change the
	 * filter state.
	 */
setFiltered:function(t){return this._toolbar.setFiltered(t),this},/**
	 * Fitbounds on the currently applied filter (if cleared, does nothing)
	 */
fitBounds:function(t){return null!=this._filterState&&this._map.fitBounds(this.options.featureGroup.getBounds(),t),this},_createFilter:function(t,e){
//Add the created shape to the filter group
this.options.featureGroup.addLayer(t.layer),
// Store the internal representation of the filter state
this._filterState={shape:t.layer,type:t.type},
// Register for the edit events on the filter shape
this._filterState.shape.on("edit",this._filterUpdatedHandler,this),
// Fire the event that we've updated the filter
e||this._map.fire("filter:filter",{geo:this._getGeo(t.type,t.layer)}),
// Set the filtered state on the toolbar
this._toolbar.setFiltered(!0)},_clearFilter:function(t){
// Remove the filter shape
try{this.options.featureGroup.clearLayers()}catch(t){}this._filterState=void 0,
// Fire the event
t||this._map.fire("filter:filter",{geo:void 0}),
// Update the toolbar state
this._toolbar.setFiltered(!1)},_filterCreatedHandler:function(t){this._createFilter({type:t.layerType,layer:t.layer})},_filterUpdatedHandler:function(){
// Only process updates when we have a stored filter shape
if(null!=this._filterState){var t={geo:this._getGeo(this._filterState.type,this._filterState.shape)};
// Only need to fire event - no need to update the toolbar
this._map.fire("filter:filter",t)}},_filterClearedHandler:function(){this._clearFilter()},_getGeo:function(t,e){return this._toolbar.getGeo(t,e)},setFilteringOptions:function(t){this._toolbar.setOptions(t)}}),L.Map.mergeOptions({drawControlTooltips:!1,filterControl:!1}),L.Map.addInitHook(function(){this.options.filterControl&&(this.filterControl=new L.Control.Filter,this.addControl(this.filterControl))}),L.control.filter=function(t){return new L.Control.Filter(t)},L.FilterToolbar=L.FontAwesomeToolbar.extend({options:{rectangle:{},polygon:{},circle:{}},initialize:function(t){L.FontAwesomeToolbar.prototype.initialize.call(this,t);/*
		 * Override default options based on what is passed in
		 * Set the options to be the combination of what was passed in and what is default
		 */
for(var e in this.options)this.options.hasOwnProperty(e)&&t[e]&&(t[e]=L.extend({},this.options[e],t[e]));
// Set this.options to be options since we have already extended the options
this.options=t,this._toolbarClass="leaflet-draw-filter"},getModeHandlers:function(t){var e=[];return null!=L.Filter.Rectangle&&e.push({enabled:this._isEnabled(this.options.rectangle),handler:new L.Filter.Rectangle(t,this.options.rectangle),title:L.filterLocal.filter.toolbar.buttons.rectangle,icon:"fa icon-square"}),null!=L.Filter.Polygon&&e.push({enabled:this._isEnabled(this.options.polygon),handler:new L.Filter.Polygon(t,this.options.polygon),title:L.filterLocal.filter.toolbar.buttons.polygon,icon:"fa icon-hex"}),null!=L.Filter.Circle&&e.push({enabled:this._isEnabled(this.options.circle),handler:new L.Filter.Circle(t,this.options.circle),title:L.filterLocal.filter.toolbar.buttons.circle,icon:"fa fa-circle-o"}),null!=L.Filter.Clear&&e.push({enabled:!0,handler:new L.Filter.Clear(t,this.options.clear),title:L.filterLocal.filter.toolbar.buttons.clear,icon:"fa fa-trash-o"}),e},
// Get the actions part of the toolbar
getActions:function(){return[{title:L.filterLocal.filter.toolbar.actions.title,text:L.filterLocal.filter.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(t){L.setOptions(this,t);for(var e in this._modes)this._modes.hasOwnProperty(e)&&t.hasOwnProperty(e)&&this._modes[e].handler.setOptions(t[e])},addToolbar:function(t){var e=L.FontAwesomeToolbar.prototype.addToolbar.call(this,t);return this.setFiltered(!1),e},setFiltered:function(t){var e;if(t){for(e in this._modes)
// The two draw buttons are disabled when we are filtered
null!=this._modes[e].button&&(L.DomUtil.addClass(this._modes[e].button,"leaflet-disabled"),this._modes[e].button.setAttribute("title",L.filterLocal.filter.toolbar.buttons.disabled)),this._modes[e].handler.lock();
// Clear button is enabled
L.DomUtil.removeClass(this._modes.clear.button,"leaflet-disabled"),this._modes.clear.button.setAttribute("title",L.filterLocal.filter.toolbar.buttons.clear),this._modes.clear.handler.unlock()}else{for(e in this._modes)null!=this._modes[e].button&&(
// The two draw buttons are enabled when there are no filters
L.DomUtil.removeClass(this._modes[e].button,"leaflet-disabled"),this._modes[e].button.setAttribute("title",L.filterLocal.filter.toolbar.buttons[e])),this._modes[e].handler.unlock();
// Clear button is disabled
L.DomUtil.addClass(this._modes.clear.button,"leaflet-disabled"),this._modes.clear.button.setAttribute("title",L.filterLocal.filter.toolbar.buttons.clearDisabled),this._modes.clear.handler.lock()}},setFilter:function(t,e){if(null!=this._modes[t.type]){var i=this._modes[t.type].handler;i.enable(e),this.setFiltered(null!=t);var o=i.setFilter(t);return i.disable(e),o}console.error("Unsupported filter type: "+t.type)},getGeo:function(t,e){return this._modes[t].handler.getGeo(e)},equals:function(t,e){return null!=t&&null!=t.type||(t=null),null!=e&&null!=e.type||(e=null),null==t&&null==e||null!=t&&null!=e&&this._modes[t.type].handler.equals(t,e)},_isEnabled:function(t){return null!=t&&(null==t.enabled||t.enabled)}}),Object.defineProperty(t,"__esModule",{value:!0})});