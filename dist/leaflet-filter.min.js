/*! @asymmetrik/leaflet-filter-1.0.11 - Copyright Asymmetrik, Ltd. 2007-2017 - All Rights Reserved.*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.leafletFilter=t.leafletFilter||{})}(this,function(t){"use strict";L.filterLocal={filter:{toolbar:{actions:{title:"Cancel drawing",text:"Cancel"},buttons:{rectangle:"Draw a bounding box filter",polygon:"Draw a bounding polygon filter",polyline:"",circle:"Draw a bounding circle filter",disabled:"Filter already applied",clear:"Clear current filter",clearDisabled:"No active filter"}},handlers:{simpleshape:{tooltip:{end:"Release mouse to finish drawing."}},rectangle:{tooltip:{start:"Click and drag to draw rectangle."}},polyline:{tooltip:{start:"",cont:"",end:""}},polygon:{tooltip:{start:"Click to start drawing shape.",cont:"Click to continue drawing shape.",end:"Click first point to close this shape."}},circle:{tooltip:{start:"Click and drag to draw circle."}}}}},L.FontAwesomeToolbar=L.Class.extend({includes:[L.Mixin.Events],initialize:function(t){L.setOptions(this,t),this._modes={},this._actionButtons=[],this._activeMode=null},enabled:function(){return null!==this._activeMode},disable:function(){this.enabled()&&this._activeMode.handler.disable()},addToolbar:function(t){var e,i=L.DomUtil.create("div","leaflet-draw-section"),o=0,n=this._toolbarClass||"",s=this.getModeHandlers(t);for(this._toolbarContainer=L.DomUtil.create("div","leaflet-draw-toolbar leaflet-fa-toolbar leaflet-bar"),this._map=t,e=0;e<s.length;e++)this._initModeHandler(s[e].handler,this._toolbarContainer,s[e].enabled?o++:-1,n,s[e].title,s[e].icon);if(o)return this._lastButtonIndex=--o,this._actionsContainer=L.DomUtil.create("ul","leaflet-draw-actions"),i.appendChild(this._toolbarContainer),i.appendChild(this._actionsContainer),i},getModeHandlers:function(t){return[]},removeToolbar:function(){for(var t in this._modes)this._modes.hasOwnProperty(t)&&(this._disposeButton(this._modes[t].button,this._modes[t].handler.enable,this._modes[t].handler),this._modes[t].handler.disable(),this._modes[t].handler.off("enabled",this._handlerActivated,this).off("disabled",this._handlerDeactivated,this));this._modes={};for(var e=0,i=this._actionButtons.length;e<i;e++)this._disposeButton(this._actionButtons[e].button,this._actionButtons[e].callback,this);this._actionButtons=[],this._actionsContainer=null},_initModeHandler:function(t,e,i,o,n,s){var l=t.type;this._modes[l]={},this._modes[l].handler=t,-1!==i&&(this._modes[l].button=this._createButton({title:n,icon:s,className:o+"-"+l,container:e,callback:this._modes[l].handler.enable,context:this._modes[l].handler}),this._modes[l].buttonIndex=i),this._modes[l].handler.on("enabled",this._handlerActivated,this).on("disabled",this._handlerDeactivated,this)},_createButton:function(t){var e=L.DomUtil.create("a",t.className||"",t.container);return null!=t.icon&&L.DomUtil.create("i",t.icon,e),e.href="#",t.text&&(e.innerHTML=t.text),t.title&&(e.title=t.title),L.DomEvent.on(e,"click",L.DomEvent.stopPropagation).on(e,"mousedown",L.DomEvent.stopPropagation).on(e,"dblclick",L.DomEvent.stopPropagation).on(e,"click",L.DomEvent.preventDefault).on(e,"click",t.callback,t.context),e},_disposeButton:function(t,e){L.DomEvent.off(t,"click",L.DomEvent.stopPropagation).off(t,"mousedown",L.DomEvent.stopPropagation).off(t,"dblclick",L.DomEvent.stopPropagation).off(t,"click",L.DomEvent.preventDefault).off(t,"click",e)},_handlerActivated:function(t){this.disable(),this._activeMode=this._modes[t.handler],null!=this._activeMode.button&&(L.DomUtil.addClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._showActionsToolbar()),this.fire("enable")},_handlerDeactivated:function(){this._hideActionsToolbar(),null!=this._activeMode.button&&L.DomUtil.removeClass(this._activeMode.button,"leaflet-draw-toolbar-button-enabled"),this._activeMode=null,this.fire("disable")},_createActions:function(t){var e,i,o,n,s=this._actionsContainer,l=this.getActions(t),a=l.length;for(i=0,o=this._actionButtons.length;i<o;i++)this._disposeButton(this._actionButtons[i].button,this._actionButtons[i].callback);for(this._actionButtons=[];s.firstChild;)s.removeChild(s.firstChild);for(var r=0;r<a;r++)"enabled"in l[r]&&!l[r].enabled||(e=L.DomUtil.create("li","",s),n=this._createButton({title:l[r].title,text:l[r].text,container:e,callback:l[r].callback,context:l[r].context}),this._actionButtons.push({button:n,callback:l[r].callback}))},_showActionsToolbar:function(){var t=this._activeMode.buttonIndex,e=this._lastButtonIndex,i=this._activeMode.button.offsetTop-1;this._createActions(this._activeMode.handler),this._actionsContainer.style.top=i+"px",0===t&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-top")),t===e&&(L.DomUtil.addClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.addClass(this._actionsContainer,"leaflet-draw-actions-bottom")),this._actionsContainer.style.display="block"},_hideActionsToolbar:function(){this._actionsContainer.style.display="none",L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-notop"),L.DomUtil.removeClass(this._toolbarContainer,"leaflet-draw-toolbar-nobottom"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-top"),L.DomUtil.removeClass(this._actionsContainer,"leaflet-draw-actions-bottom")}}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Feature=L.Handler.extend({includes:L.Mixin.Events,initialize:function(t,e){this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,e&&e.shapeOptions&&(e.shapeOptions=L.Util.extend({},this.options.shapeOptions,e.shapeOptions)),L.setOptions(this,e)},enable:function(t){this._enabled||this.isLocked()||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),t||this._map.fire("filter:filterstart",{layerType:this.type}))},disable:function(t){this._enabled&&(L.Handler.prototype.disable.call(this),t||this._map.fire("filter:filterstop",{layerType:this.type}),this.fire("disabled",{handler:this.type}))},lock:function(){this._locked=!0},unlock:function(){this._locked=!1},isLocked:function(){return null!=this._locked&&this._locked},addHooks:function(){var t=this._map;t&&(L.DomUtil.disableTextSelection(),t.getContainer().focus(),this._tooltip=new L.Draw.Tooltip(this._map),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(t){L.setOptions(this,t)},_fireCreatedEvent:function(t){this._map.fire("filter:created",{layer:t,layerType:this.type})},_cancelDrawing:function(t){27===t.keyCode&&this.disable()}}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.SimpleShape=L.Filter.Feature.extend({options:{},initialize:function(t,e){this._endLabelText=L.filterLocal.filter.handlers.simpleshape.tooltip.end,L.Filter.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Filter.Feature.prototype.addHooks.call(this),this._map&&(this._mapDraggable=this._map.dragging.enabled(),this._mapDraggable&&this._map.dragging.disable(),this._container.style.cursor="crosshair",this._tooltip.updateContent({text:this._initialLabelText}),this._map.on("mousedown",this._onMouseDown,this).on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Filter.Feature.prototype.removeHooks.call(this),this._map&&(this._mapDraggable&&this._map.dragging.enable(),this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this),L.DomEvent.off(document,"mouseup",this._onMouseUp,this),this._shape&&(this._map.removeLayer(this._shape),delete this._shape)),this._isDrawing=!1},_getTooltipText:function(){return{text:this._endLabelText}},_onMouseDown:function(t){this._isDrawing=!0,this._startLatLng=t.latlng,L.DomEvent.on(document,"mouseup",this._onMouseUp,this).preventDefault(t.originalEvent)},_onMouseMove:function(t){var e=t.latlng;this._tooltip.updatePosition(e),this._isDrawing&&(this._drawShape(e),this._tooltip.updateContent(this._getTooltipText()))},_onMouseUp:function(){this._shape&&this._fireCreatedEvent(),this.disable()}}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Polyline=L.Filter.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{enabled:!0,allowIntersection:!1,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!1,clickable:!0,editable:!0},metric:!0,showLength:!0,zIndexOffset:2e3},initialize:function(t,e){this._endLabelText=L.filterLocal.filter.handlers.polyline.tooltip.end,this.options.drawError.message=L.filterLocal.filter.handlers.polyline.error,e&&e.drawError&&(e.drawError=L.Util.extend({},this.options.drawError,e.drawError)),L.Filter.Feature.prototype.initialize.call(this,t,e)},addHooks:function(){L.Filter.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mousedown",this._onMouseDown,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this).on("mouseup",this._onMouseUp,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Filter.Feature.prototype.removeHooks.call(this),this._map&&(this._container.style.cursor="",this._map.off("mousedown",this._onMouseDown,this).off("mousemove",this._onMouseMove,this),L.DomEvent.off(document,"mouseup",this._onMouseUp,this),this._markerGroup&&(this._map.removeLayer(this._markerGroup),delete this._markerGroup),this._poly&&(this._map.removeLayer(this._poly),delete this._poly)),this._isDrawing=!1},disable:function(t){L.Filter.Feature.prototype.disable.call(this,t),this._clearMouseMarker(),this._clearGuides()},_getTooltipText:function(){return{text:this._endLabelText}},deleteLastVertex:function(){if(!(this._markers.length<=1)){var t=this._markers.pop(),e=this._poly,i=this._poly.spliceLatLngs(e.getLatLngs().length-1,1)[0];this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(i,!1)}},addVertex:function(t){var e=this._markers.length;e>0&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t)||(this._markers.push(this._createMarker(t)),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(t,!0))},_finishShape:function(){var t=this._poly.newLatLngIntersects(this._poly.getLatLngs()[0],!0);!this.options.allowIntersection&&t||!this._shapeIsValid()||(this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable(),this._clearGuides(),this._clearMouseMarker())},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._updateGuide()},_onMouseMove:function(t){var e=t.layerPoint,i=t.latlng;this._currentLatLng=i,this._updateTooltip(i),this._updateGuide(e),this._mouseMarker.setLatLng(i),L.DomEvent.preventDefault(t.originalEvent)},_vertexChanged:function(t,e){this._updateFinishHandler(),this._updateRunningMeasure(t,e),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(t){var e=t.originalEvent;this._mouseDownOrigin=L.point(e.clientX,e.clientY)},_onMouseUp:function(t){if(this._mouseDownOrigin){var e=L.point(t.originalEvent.clientX,t.originalEvent.clientY).distanceTo(this._mouseDownOrigin);Math.abs(e)<9&&this.addVertex(t.latlng)}this._mouseDownOrigin=null},_updateFinishHandler:function(){var t=this._markers.length;t>1&&this._markers[t-1].on("click",this._finishShape,this),t>2&&this._markers[t-2].off("click",this._finishShape,this)},_createMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),e},_updateGuide:function(t){var e=this._markers.length;e>0&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[e-1].getLatLng()),t))},_updateRunningMeasure:function(t,e){var i,o,n=this._markers.length;1===this._markers.length?this._measurementRunningTotal=0:(i=n-(e?2:1),o=t.distanceTo(this._markers[i].getLatLng()),this._measurementRunningTotal+=o*(e?1:-1))},_updateTooltip:function(t){var e=this._getTooltipText();t&&this._tooltip.updatePosition(t),this._errorShown||this._tooltip.updateContent(e)},_drawGuide:function(t,e){var i,o,n,s=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))),l=this.options.guidelineDistance,a=this.options.maxGuideLineLength,r=s>a?s-a:l;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));r<s;r+=this.options.guidelineDistance)i=r/s,o={x:Math.floor(t.x*(1-i)+i*e.x),y:Math.floor(t.y*(1-i)+i*e.y)},n=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),n.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(n,o)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,i=this._guidesContainer.childNodes.length;e<i;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},_clearMouseMarker:function(){this._mouseMarker&&(this._map.removeLayer(this._mouseMarker),delete this._mouseMarker)},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var t=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Filter.Feature.prototype._fireCreatedEvent.call(this,t)}}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Polygon=L.Filter.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{enabled:!0,showArea:!1,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,editable:!0},metric:!0},initialize:function(t,e){this.type=L.Filter.Polygon.TYPE,L.Filter.Polyline.prototype.initialize.call(this,t,e),this._initialLabelText=L.filterLocal.filter.handlers.polygon.tooltip.start,this._endLabelText=L.filterLocal.filter.handlers.polygon.tooltip.end},setFilter:function(t){var e=new L.Polygon(t.latlngs,this.options.shapeOptions);return{type:"polygon",layer:e}},equals:function(t,e){if(t.type!=e.type)return!1;var i=JSON.stringify(t.latlngs),o=JSON.stringify(e.latlngs);return i==o},getGeo:function(t){return{type:"polygon",latlngs:t.getLatLngs()}},_drawShape:function(t){return this._poly?this._poly.setLatLngs(t):(this._poly=new L.Polygon(t,this.options.shapeOptions),this._map.addLayer(this._poly)),{type:"polygon",layer:this._poly}},_fireCreatedEvent:function(){var t=new L.Polygon(this._poly.getLatLngs(),this.options.shapeOptions);L.Filter.Polyline.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,o=L.Filter.Polyline.prototype._getTooltipText.call(this),n=this._poly;return n&&(t=n.getLatLngs(),e=L.GeometryUtil.geodesicArea(t),i=L.GeometryUtil.readableArea(e,this.options.metric)),{text:o.text,subtext:i}},_updateFinishHandler:function(){var t=this._markers.length;1===t&&this._markers[0].on("click",this._finishShape,this),t>2&&(this._markers[t-1].on("dblclick",this._finishShape,this),t>3&&this._markers[t-2].off("dblclick",this._finishShape,this))},_getMeasurementString:function(){var t=this._area;return t?L.GeometryUtil.readableArea(t,this.options.metric):null},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(t,e){var i;!this.options.allowIntersection&&this.options.showArea&&(i=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(i)),L.Filter.Polyline.prototype._vertexChanged.call(this,t,e)},_cleanUpShape:function(){var t=this._markers.length;t>0&&(this._markers[0].off("click",this._finishShape,this),t>2&&this._markers[t-1].off("dblclick",this._finishShape,this))}}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Circle=L.Filter.SimpleShape.extend({statics:{TYPE:"circle"},options:{enabled:!0,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,editable:!0},showRadius:!0,metric:!0},initialize:function(t,e){this.type=L.Filter.Circle.TYPE,this._initialLabelText=L.filterLocal.filter.handlers.circle.tooltip.start,L.Filter.SimpleShape.prototype.initialize.call(this,t,e)},getGeo:function(t){var e=t.getLatLng(),i=t.getRadius();return{type:"circle",center:e,radius:i}},setFilter:function(t){this._startLatLng=t.center;var e=new L.Circle(t.center,t.radius,this.options.shapeOptions);return{type:"circle",layer:e}},equals:function(t,e){return t.type==e.type&&(t.center.lat===e.center.lat&&t.center.lng===e.center.lng&&t.radius===e.radius)},_drawShape:function(t){return this._shape?this._shape.setRadius(this._startLatLng.distanceTo(t)):(this._shape=new L.Circle(this._startLatLng,this._startLatLng.distanceTo(t),this.options.shapeOptions),this._map.addLayer(this._shape)),{type:"circle",layer:this._shape}},_fireCreatedEvent:function(){var t=new L.Circle(this._shape.getLatLng(),this._shape.getRadius(),this.options.shapeOptions);L.Filter.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,o,n=L.Filter.SimpleShape.prototype._getTooltipText.call(this),s=this._shape;return s&&(e=this._shape.getBounds(),t=[e.getNorthWest(),e.getNorthEast(),e.getSouthEast(),e.getSouthWest()],i=L.GeometryUtil.geodesicArea(t)/4*Math.PI,o=L.GeometryUtil.readableArea(i,this.options.metric)),{text:n.text,subtext:o}}}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Rectangle=L.Filter.SimpleShape.extend({statics:{TYPE:"rectangle"},options:{enabled:!0,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,editable:!0},metric:!0},initialize:function(t,e){this.type=L.Filter.Rectangle.TYPE,this._initialLabelText=L.filterLocal.filter.handlers.rectangle.tooltip.start,L.Filter.SimpleShape.prototype.initialize.call(this,t,e)},getGeo:function(t){return{type:"rectangle",northEast:{lat:t.getBounds()._northEast.lat,lng:t.getBounds()._northEast.lng},southWest:{lat:t.getBounds()._southWest.lat,lng:t.getBounds()._southWest.lng}}},setFilter:function(t){this._startLatLng=t.northEast;var e=new L.Rectangle(new L.LatLngBounds(this._startLatLng,t.southWest),this.options.shapeOptions);return{type:"rectangle",layer:e}},equals:function(t,e){return t.type==e.type&&(t.northEast.lat===e.northEast.lat&&t.northEast.lng===e.northEast.lng&&t.southWest.lat===e.southWest.lat&&t.southWest.lng===e.southWest.lng)},_drawShape:function(t){return this._shape?this._shape.setBounds(new L.LatLngBounds(this._startLatLng,t)):(this._shape=new L.Rectangle(new L.LatLngBounds(this._startLatLng,t),this.options.shapeOptions),this._map.addLayer(this._shape)),{type:"rectangle",layer:this._shape}},_fireCreatedEvent:function(){var t=new L.Rectangle(this._shape.getBounds(),this.options.shapeOptions);L.Filter.SimpleShape.prototype._fireCreatedEvent.call(this,t)},_getTooltipText:function(){var t,e,i,o,n=L.Filter.SimpleShape.prototype._getTooltipText.call(this),s=this._shape;return s&&(e=this._shape.getBounds(),t=[e.getNorthWest(),e.getNorthEast(),e.getSouthEast(),e.getSouthWest()],i=L.GeometryUtil.geodesicArea(t)/4*Math.PI,o=L.GeometryUtil.readableArea(i,this.options.metric)),{text:n.text,subtext:o}}}),L.Filter=null!=L.Filter?L.Filter:{},L.Filter.Clear=L.Handler.extend({statics:{TYPE:"clear"},includes:L.Mixin.Events,initialize:function(t,e){L.Handler.prototype.initialize.call(this,t),L.Util.setOptions(this,e),this.type=L.Filter.Clear.TYPE},lock:function(){this._locked=!0},unlock:function(){this._locked=!1},isLocked:function(){return null!=this._locked&&this._locked},enable:function(){this.isLocked()||this._map.fire("filter:cleared")},disable:function(){}}),L.Control.Filter=L.Control.extend({options:{position:"topleft",filter:{rectangle:{},polygon:{},circle:{}}},initialize:function(t){if(L.Control.prototype.initialize.call(this,t),null==t.featureGroup||!(t.featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be an L.FeatureGroup");L.FilterToolbar&&this.options.filter&&(this._toolbar=new L.FilterToolbar(this.options.filter))},onAdd:function(t){var e,i=L.DomUtil.create("div","leaflet-draw"),o="leaflet-draw-toolbar-top";return e=this._toolbar.addToolbar(t),e&&(L.DomUtil.hasClass(e,o)||L.DomUtil.addClass(e.childNodes[0],o),i.appendChild(e)),t.on("filter:created",this._filterCreatedHandler,this),t.on("filter:cleared",this._filterClearedHandler,this),i},onRemove:function(t){t.off("filter:created",this._filterCreatedHandler,this),t.off("filter:cleared",this._filterClearedHandler,this),null!=this._filterState&&this._filterState.shape.off("edit",this._filterUpdatedHandler,this),this._toolbar.removeToolbar()},equals:function(t,e){return this._toolbar.equals(t,e)},setFilter:function(t,e){e=e||{suppressEvents:!1,fitBounds:!1};var i=null!=this._filterState?this._getGeo(this._filterState.type,this._filterState.shape):void 0;if(!this._toolbar.equals(i,t)){if(null!=t){this._clearFilter(!0);var o=this._toolbar.setFilter(t,e.suppressEvents);this._createFilter(o,e.suppressEvents),e.fitBounds&&this._map.fitBounds(o.layer.getBounds())}else this._clearFilter();return this}},setFiltered:function(t){return this._toolbar.setFiltered(t),this},fitBounds:function(t){return null!=this._filterState&&this._map.fitBounds(this.options.featureGroup.getBounds(),t),this},_createFilter:function(t,e){this.options.featureGroup.addLayer(t.layer),this._filterState={shape:t.layer,type:t.type},this._filterState.shape.on("edit",this._filterUpdatedHandler,this),e||this._map.fire("filter:filter",{geo:this._getGeo(t.type,t.layer)}),this._toolbar.setFiltered(!0)},_clearFilter:function(t){this.options.featureGroup.clearLayers(),this._filterState=void 0,t||this._map.fire("filter:filter",{geo:void 0}),this._toolbar.setFiltered(!1)},_filterCreatedHandler:function(t){this._createFilter({type:t.layerType,layer:t.layer})},_filterUpdatedHandler:function(){if(null!=this._filterState){var t={geo:this._getGeo(this._filterState.type,this._filterState.shape)};this._map.fire("filter:filter",t)}},_filterClearedHandler:function(){this._clearFilter()},_getGeo:function(t,e){return this._toolbar.getGeo(t,e)},setFilteringOptions:function(t){this._toolbar.setOptions(t)}}),L.Map.mergeOptions({drawControlTooltips:!1,filterControl:!1}),L.Map.addInitHook(function(){this.options.filterControl&&(this.filterControl=new L.Control.Filter,this.addControl(this.filterControl))}),L.control.filter=function(t){return new L.Control.Filter(t)},L.FilterToolbar=L.FontAwesomeToolbar.extend({options:{rectangle:{},polygon:{},circle:{}},initialize:function(t){for(var e in this.options)this.options.hasOwnProperty(e)&&t[e]&&(t[e]=L.extend({},this.options[e],t[e]));this.options=t,this._toolbarClass="leaflet-draw-filter",L.FontAwesomeToolbar.prototype.initialize.call(this,t)},getModeHandlers:function(t){var e=[];return null!=L.Filter.Rectangle&&e.push({enabled:this._isEnabled(this.options.rectangle),handler:new L.Filter.Rectangle(t,this.options.rectangle),title:L.filterLocal.filter.toolbar.buttons.rectangle,icon:"fa icon-square"}),null!=L.Filter.Polygon&&e.push({enabled:this._isEnabled(this.options.polygon),handler:new L.Filter.Polygon(t,this.options.polygon),title:L.filterLocal.filter.toolbar.buttons.polygon,icon:"fa icon-hex"}),null!=L.Filter.Circle&&e.push({enabled:this._isEnabled(this.options.circle),handler:new L.Filter.Circle(t,this.options.circle),title:L.filterLocal.filter.toolbar.buttons.circle,icon:"fa fa-circle-o"}),null!=L.Filter.Clear&&e.push({enabled:!0,handler:new L.Filter.Clear(t,this.options.clear),title:L.filterLocal.filter.toolbar.buttons.clear,icon:"fa fa-trash-o"}),e},getActions:function(){return[{title:L.filterLocal.filter.toolbar.actions.title,text:L.filterLocal.filter.toolbar.actions.text,callback:this.disable,context:this}]},setOptions:function(t){L.setOptions(this,t);for(var e in this._modes)this._modes.hasOwnProperty(e)&&t.hasOwnProperty(e)&&this._modes[e].handler.setOptions(t[e])},addToolbar:function(t){var e=L.FontAwesomeToolbar.prototype.addToolbar.call(this,t);return this.setFiltered(!1),e},setFiltered:function(t){var e,i;if(t){for(e in this._modes)i=this._modes[e].button,null!=i&&(L.DomUtil.addClass(this._modes[e].button,"leaflet-disabled"),this._modes[e].button.setAttribute("title",L.filterLocal.filter.toolbar.buttons.disabled)),this._modes[e].handler.lock();L.DomUtil.removeClass(this._modes.clear.button,"leaflet-disabled"),this._modes.clear.button.setAttribute("title",L.filterLocal.filter.toolbar.buttons.clear),this._modes.clear.handler.unlock()}else{for(e in this._modes)i=this._modes[e].button,null!=i&&(L.DomUtil.removeClass(this._modes[e].button,"leaflet-disabled"),this._modes[e].button.setAttribute("title",L.filterLocal.filter.toolbar.buttons[e])),this._modes[e].handler.unlock();L.DomUtil.addClass(this._modes.clear.button,"leaflet-disabled"),this._modes.clear.button.setAttribute("title",L.filterLocal.filter.toolbar.buttons.clearDisabled),this._modes.clear.handler.lock()}},setFilter:function(t,e){if(null!=this._modes[t.type]){var i=this._modes[t.type].handler;i.enable(e),this.setFiltered(null!=t);var o=i.setFilter(t);return i.disable(e),o}console.error("Unsupported filter type: "+t.type)},getGeo:function(t,e){return this._modes[t].handler.getGeo(e)},equals:function(t,e){return null!=t&&null!=t.type||(t=null),null!=e&&null!=e.type||(e=null),null==t&&null==e||null!=t&&null!=e&&this._modes[t.type].handler.equals(t,e)},_isEnabled:function(t){return null!=t&&(null==t.enabled||t.enabled)}}),Object.defineProperty(t,"__esModule",{value:!0})});